Should I use a turborepo setup with Next.js and Express, or just stick to Next.js and Express, for Building a WebRTC applicatoin ? Could you explain the pros and the cons in detail?

ans :  turborepo is useful when you have veyr big project, turborepo specifically is for optimising buildtime so that if you have multiple modules depending on each other and you want to build just nextJS app you only pick right things, it also gives you build caches So, whenever you are building in your CI/CD pipeline you can use their cloud offering and speed up the bulild process.

So, if you are in a very big organisation where people are shipping code like razor pay left, right anc center so, you can optimise build times if you use turborepo THIS IS DIFFERENT FROM MONOREPOS 

MONOREPO : like simple yarn workspaces help you share code, so for the exact ans at the very least use some monorepo so you have shareable code and you don't have to repeat it, write int wo diff places 

OTEHR THAN THAT THERE IS NO NEED OF TURBOREPO , OTEHRWISE IT JUST COMPLICATES THING time to time


-------------------------------------------------------------
Prima, Postgress, RTC, NextJS, Drizzle : TO BE DONE IN FUTURE CLASSES
-----------------------------------------------------------


Websocket is Protocol : similar to HTTP as it is a protocol

Websockets provide a way to establish a persistent, full duplex communication channel over a single TCP connection between the client (typically a web browser) and the server

Few Jargons here :
Persist  =>  http server 


See -> notes.pdf

So, we are learning this because Websockets let us create real time communication [RTC], for applications like NFTs value showcase webpage like Backpack we use these websockets [to aapko real time mein pata chl rha h SoLANA ka price kya hai]

another example is : metaverse game : gather town, so many people moving around, so lots of people moving in game and you can see eveyrone, so you want so much data to come very quickly from backend


So, implementing this in HTTP is headache : asking every 5 sec what is SOL price, and updating UI, but this is slower because in every request new TCP connection is being built every request very slow to have 3-way handshakes every request Therefore we want persistent connection between CLient and Server and now server keeps sending events in 30 FPS (frames/messages per second), so better in case of getting real time data


So, when you know, so much of data is gonna come and will keep on coming on very high frequency, then you use
webSockets


Use Cases of Websockets : 
1. RTC : chat application [whenever person joins chat room, they establish persistent connection with websocket server and then whenever someone messages it is displayed to all peoples  : YOU CAN DO THIS USING HTTP also : polling, long polling]
2. LiveFeeds : Financial Ticker
4. Interactive Services : Collaborative Editing tools [Excelidraw that we will create ] => if we have to see same input in collaborative editing tools in two tabs of browser in my own machine doing that is easy but someone else have access to that editing file, then it becomes a bit hard

EXAMPLE : LEETCODE USES POLLING WHEN YOU SUBMIT SOLLUTIONS

![1st request : leetcode accepts your code, it did not immediately return the status of submission](image.png)
![2nd,3rd,4th... requests from us client to leetcode servers are polling checks : is this done now, is it done, is it done or not and so on till the submission response is generated by leetcode](image-1.png)

![and finally at this poll check the polling resolves as submission happens at this time](image-2.png)

So, even company as big as LEETCODE is using HTTP only, for these kind of server side events, So, it depends on use Case and how necessary it is to use webSockets and how effective which protocol will work 
Webosckets might feel implementable theoritically at some places but it does not mean you have to use them everywhere

![Seeign websocket connection in networks tab](image-3.png)

WebSockets in NodeJs 

There are various libraries that let you create a ws server (Similar to how express lets you create an HTTP Server)
1. https://www.npmjs.com/packages/websockets
2. https://github.com/websockets/ws
3. https://socket.io   [most common and beginners used]

We'll be using ws library today

Problems in Socket.io :-
even though it is great[it gives you constructs like rooms to make API Cleaner, it is built on top of other protocols like websockets, HTTP and many more] it is harder to support multiple platforms in it (Android, IOS, Rust). There are implementations in most platforms but not very uptodate 
https://socket.io/blog/native-socket-io-and-android/
https://github.com/1c3t3a/rust-socketio



HTTP is very famous protocol : ![every platform has ways to communicate to HTTP Server](image-4.png), broweser and nodeJS has axios and fetch that supports HTTP, Java has some HTTPBuilder for to talk to it
and similarly
Websocket is also very famous protocol and different platforms have ways to talk to it, libraries built to communicate with websockets. It is natively implemented in browsers too![alt text](image-5.png)


but socketio is not implemented , it is not made by IETF that creates protocols , it is made by some third person. So is may or may not available for some platforms

So, if your application is gonna be very cross Platformed , where your backend can be talking to rust app, goLang App, C++ App, Java App and many more then you need to skip using socketio, otherwise you can use it, it makes your code look cleaner and easier to write


Writing WebSocket Code now : very simple to write websocket code as compared to Express

1. intiialise empty nodeJS project in typeScript
   >> npm init -y
2. Add tsconfig to it 
   >> npm install typescript
   >> npx tsc --init
3. updating tsconfig
   >> "rootDir" : "./src"
   >> "outDir" : "./dist"
4. install ws
   >> npm i ws @types/ws



SOME QUESTIONS 
1. WebRTC vs WS : gotowebsites like : gather.town : 2d metaverse, framevr.io:3d metaverse [when one event that comes too much, which we are not much concerned about missing then we use WebRTC otherwise we use WebSockets]
2. Polling Concept , Polling vs Long Polling
3. Types of WSS and Socket
4. Is Socket connection similar to Pub Subs in Kafka? 
   -> They are diff protocols, browsers cannot talk to pubsubs, rabbitMQ isntance or kafka instance. Browsers only talk HTTP, webSockets, webRTC they can't talk deatabases

5. Amazon on Big Billion Day Sales uses webSockets ?

Let's write Client Side code for WebSocket : Let's create a ping pong application [whenever you send server ping it responds with pong] /  echo Application [here whatever you send yto websocket serve the server responds back with same message]
-> after creater webSocket Backend, lets do fronted [client side code]

// So we will leanr more elegant way of interacting with websockets : using react hook : useSocket() but for now just coding ugly version of it

//Scaling WebSocket Server -------------------------------------------------

[Why this is more challenging problem than scaling HTTP serves ]
In real world, you want multiple HTTP servers to loadBalancing. Thsi fleet of servers keep on inc and dec depending on user requirements. So, this infrastructure can be scaled up and down, HTTP servers are stateless, their state is stored in DB.
So, when you have more user requirement you can easily start a machine, process in your host machine, or you can delete the server when wanting to shut down.The reason thsi is possible is all because HTTP servers are stateless and data is shared in DB [it is common place where all the data is stored]


WebSockets : Can be OR Cannot be Stateless, we can use database, but most of the time they are not stateless.
Assume you are chatting with someone in pubG game and connected to same webSocket server [WebSockets are sticky or Statefull, it doesnot matter hwo many webSocket servers you have, if some people need to communicate they need to be connected to same websocket server]

So, it cannot be the case that some people that wanna chat are connected to two diff weebsocket servers and talk -> as in order to get same messages they need to be connected to same server, also you cannot store the socket of another user in DB and then send the message back throught this socket via another webSocket server [It is like when a client connected to HTTP server you wanna store that clients res object to DB somehow by stringifying is all encoding and all and then sending this res object from another HTTP Server : this is not possible BECAUSE, the res object of client in original HTTP server is connection btw the client and that server, that connection pipeline you cannot copy and send from another HTTP Sever as the connection of client with this new HTTP serrver will be another connection pipeline]

So, with websockets people chatting in same room need to be connected to same websocket server, different rooms can have different load Balancers. Therefore, scaling websockets are hard, as http load balancing servers can send request to any of the server available at that point of time, but in case of websockets, clients subscribed to same service need to be connecting to same webSocket Server

So, upscaling webSockets where all the users are connected to is very challenging as you have to drain all users from existing websocket server and move to new server. If you directly delete the websocket server then connection all users die, and these people will now not know where to connect to in order to talk or be in same room 

If you have millions of people : you might need 5 http server
If you have millions of people talking to each other in a game  :  you will need hundreds of websocket servers

one websocket server [in single thread in nodeJS] can handle only upto ~10,000 or 20,000 user connections. Therefore if you have millions of clients real time connected to serve you cannot use this architecture [sticky connection architecture of webSockets] 

So, if you actually wanna scale it to millions of people in same room then you use something called PubSubs in Kafka ![pubsubs](image-6.png)

PubSubs for now can be thought as another servers [here, websocket servers start talking to each other too in order to fully facilitate that large number of users RTC]. So Now, PubSub needs to scale very well inorder to be fully functional in high and low demands 


NEXT CLASS CHATS : SIMPLE CHAT APP
[Scalable chat app can't be build untill we know pubSubs, explore]


Suppose there is a situation where, you are not connected to a chat app and someone texts you. Now, whenever you come online you recieve messages . How does that work ? shouldn't the messages be deleted.

So what happens is when you are not connected to chap app socket connection, their messages are getting stored in some kind of database or something and when they come online, they send a http rewuest to http server to ask what all messages I have recieved till I came Online last and it responses with unread chats and at the same time the user also connects to webSocket server to facilitate real time communication, for if anyone sends messafe now, then it will be immediately recieved
![alt text](image-7.png) a bit cleaner version ![alt text](image-8.png)

How to deal with message encryption : Explore

youtube live chat, uses api polling for real time chat, why so, I heard people say that making a api call should be minimum ?
ans : What youtube is doing is they are bringing live chats in batches, if they bring via websockets it will be very fast kind of unreadable in cases when you have thousands of people sending chats in same moment of time, so, they do API call every 10 ms say to bring some batch of chats (say, 10-20 chats) to the liveChat.So they build a featgure over HTTP, also it is easy to scale http as compared to websockets   

TODO:--------------------------------------------------------------
1. Authentication : Access Token, Refresh Token and Session Based Auth
2. Learn Sockektio yourself  :  coinDCX uses and canva uses it, it makes life little bit easy, and provides soem extra functionality on top like rooms, we will quickly code and see what is difference here in socket.io or websocket 
3. OAuth : Learn before kirat teaches
4. See GoLang Notion Doc and Python FastAPI notion doc
5. Scaling WebSocket Server is good to learn about : as this is 10x more challenging than scaling HTTP server
6. How to create chat app with HTTP server only : long Polling : so client keeps on asking http server if messaege came or not
So, can you create Duplex/FullDuplex Apps using HTTP only Server : How ? By Polling
7. Build Brainly App -> Build Chess           : youtube brooo
8. Build MetaVerse App                        : youtube brooo
   [

   So, MOST OF THE WEB APPLICATIONS CAN BE MADE USING THESE :-
    -> you need websocket server, you need PRISMA ORM and postgresss database in backennd

    -> HTTP server, Database, reddis as cache, react or nextJS as frontend, ORMs like prisma, webSocket Server for Real Time Communication. 

    -> Advanced can be : Backends talk to each other, queues, pubSubs, algorthmic arenas

   ]

9. Explore Scalabale Chat App [once you understand the implementation and can implement it; see how chat encryption is done]  -> then move to learning and creating scalable chess app, scalable gather town app

10. BGMI : how does it work where millions of users play and connect with others in game

11. Kirats having problem straining cream out of the milk 
12. WebSocket vs HTTP CONNECTION POOL . How to 
13. See this  -> GRPC uses HTTP2 and support streaming.
    [you can stream in newer versions of HTTP, they do allow to send data through streams but not adopted much]

14. When websockets don't work with nextjs or vercel ? 
    [because they do serverSide rendering, nextJS does not support api endpoints and it does not support websockets on backend, you have to write separately, and even if you are trying to connect to it, it will connet from the server. So you have to force the component [where you need to connect to webSocket server] to be a client side rendered component, so when you try to make websocket connection to server via component then it breaks, if client component tries to make ws connection then also it breaks . So, Client component, server component both breaks, it will try to create ws connection from browser and ws sever that will be issue]

    
15.     




